# 낙관적 업데이트 (Optimistic Update)

api 연결하는 개발 할 때마다 늘 ‘이거 서버 mutation 요청 후에 걍 프론트에서 바꼈다고 치고 UI 업데이트 해주는게 좋을까요 아니면 바로 get 받아오는게 좋을까요?’ 이런 식으로 구구절절 설명했던 것이 바로 한 문장으로 요약되었다.

- “낙관적 업데이트 적용할까요?”

그래서 낙관적 업데이트가 뭔데~

## what is Optimistic Update?

- 데이터가 실제로 변경 되었음을 서버로부터 확인 하기 전에, 변경이 성공적으로 완료된 것 처럼 사용자에게 보여주는 것
- 말그대로 낙관적으로 “응 ~ 어차피 요청 성공하고 데이터 잘 반영될거야^^ㅋ” 라고 생각하고 UI 부터 성공 상태로 바꾸는거다.

그러면 비관적 업데이트도 있을까? 아무튼 반대로는 “무조건 서버에서 변경된 데이터를 받았을 때에만 UI 를 변경해주는 것” 이 될 것이다.

그럼 언제 어떻게 써야하나

## how - optimistic update

만약 낙관적 업데이트를 하지 않는다고 생각하고 트위터의 좋아요 기능의 시나리오를 작성해보자.

1.  사용자가 좋아요 버튼을 클릭
2.  클릭 후, mutation 요청이 서버로 보내짐
3.  서버 요청에 대한 응답이 올 때 까지 기다림 혹은 mutation 성공 시 get 요청을 다시 하여 refetch
4.  갱신된 데이터 화면에 보여줌

이것의 단점은 무엇일까 당연히 `사용자를 기다리게 한다.` 는 것이겠다.

그럼 낙관적 업데이트를 해보자

1.  사용자가 좋아요 버튼 클릭
2.  좋아요 + 1 되었다고 가정하고 UI 에 반영
3.  클릭 후 mutation 요청이 서버로 보내짐
4.  서버로부터 응답 받음 - 만약 에러 날 시, UI 를 롤백한다.

이렇게 하면 빠르게 사용자에게 요청의 성공을 알려 줄 수 있다.

## pros & cons

### pros

- 사용자를 기다리게 하지 않는다. 따라서 좋은 사용자 경험을 갖게 한다.
- cons
- “진짜” 데이터 업데이트 시점에 대한 고민이 필요하다.
- 에러 처리를 언제/어떻게 해줄 것인가에 대한 고민이 필요하다.
- 사용자에게 정확한 최신의 데이터를 알려줘야 하는 경우에는(은행 잔고..?) 사용자에게 거짓말을 하는 셈이된다.
  - 만약에 은행잔고를 낙관적 업데이트 한 상태만 보고 사용자가 해당 은행 어플을 나가게 되면..? 근데 만약에 서버 요청이 실패한다면..? 사용자는 다시 은행 어플을 들어왔을 때 변경된 은행 잔고를 볼 것이고 이는 소프트웨어에 대한 불신으로 이어질 것 같다.

## when to use

내 생각에는

- 요청이 성공했다가 실패해도, 그리고 그 실패 사실을 사용자가 늦게 알아도 사용자 경험에 큰 타격이 없는 경우 (위의 은행잔고는 사용자 경험에 큰 타격을 줄 것 같고, 좋아요 같은 기능은 큰 타격이 없을 것 같다.)
- 사용자에게 빠르게 인터렉션을 주고 싶은 경우

만약 좋아요와 같은 단순 데이터 수정이 아니라, list 내 새로운 item을 낙관적 업데이트 해야하는 상황이라면 아래와 같은 문제점도 있다.

- 추가하는 list에 id가 필요한 경우, 어떻게 얻어야하나? (DB 에서 넣어주는 값일텐데..만약 프론트엔드에서 임의로 넣었다가 사용자가 아주빠르게 삭제요청하면 삭제가 안된다.)
- 현재 보고 있는 list가 정렬된 경우 올바른 위치에 새로운 item을 넣으려면 어디에 넣어야하나?
- 그 사이에 다른 사용자가 item을 추가한다면?

이러한 엣지케이스는 사용자 경험을 더 악화시키므로 낙관적 업데이트보다는 비관적 업데이트가 더 좋은 사용자 경험을 이끌어 낼 것 같다.

[True lies of Optimistic UI - 옵티미스틱 UI의 계산된 거짓말](https://story.pxd.co.kr/1193)
